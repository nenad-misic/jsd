-- Autogenerated from {{model_filename}} file
-- Created at {{timestamp|strftime}}

{% for entity in application.entities %}
CREATE TABLE {{entity.name}} (
    {% for property in entity.properties %}
    {{property.name}} {{property.type|sqliteType}}{% for constraint in property.constraints %}{% if constraint|sqliteConstraint != ''%} {% endif %}{{constraint|sqliteConstraint}}{% endfor %}{% if not (loop.last) or entity.relationships %},{% endif %}
    
    {% endfor %}
    {% for relationship in entity.relationships %}
    {% if relationship.source == entity %}
    {{relationship.sourceInjectedField.fieldName}} {{(relationship.target|primaryKeyProp).type|sqliteType}},
    {% endif %}
    {% if relationship.target == entity%}
    {{relationship.targetInjectedField.fieldName}} {{(relationship.source|primaryKeyProp).type|sqliteType}},
    {% endif %}
    {% endfor %}
    {% for relationship in entity.relationships %}
    {% if relationship.source == entity %}
    FOREIGN KEY ({{relationship.sourceInjectedField.fieldName}})
    REFERENCES {{relationship.target.name}} ({{(relationship.target|primaryKeyProp).name}})
    ON DELETE NO ACTION 
    ON UPDATE NO ACTION{% if not loop.last %},{% endif %}
    {% endif %}
    {% if relationship.target == entity %}
    FOREIGN KEY ({{relationship.targetInjectedField.fieldName}})
    REFERENCES {{relationship.source.name}} ({{(relationship.source|primaryKeyProp).name}}) 
    ON DELETE NO ACTION 
    ON UPDATE NO ACTION{% if not loop.last %},{% endif %}
    {% endif %}
    
    {% endfor %}
);
{% endfor %}

